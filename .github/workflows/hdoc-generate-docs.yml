name: Generate documentation with hdoc

on:
  push:
    branches:
      - 'release/**'

jobs:
  build_clang:
    name: LLVM/Clang docs
    runs-on: ubuntu-latest
    steps:
    - name: Install Ninja
      uses: llvm/actions/install-ninja@main
    - uses: actions/checkout@v1
    - name: Test clang
      uses: llvm/actions/build-test-llvm-project@main
      with:
        cmake_args: >
          -G Ninja
          -DCMAKE_BUILD_TYPE=Debug
          -DCMAKE_EXPORT_COMPILE_COMMANDS=1
          -DLLVM_ENABLE_PROJECTS="clang"
          -DLLVM_TARGETS_TO_BUILD="X86"
          -DLLVM_INCLUDE_BENCHMARKS=OFF
          -DLLVM_INCLUDE_EXAMPLES=OFF
          -DLLVM_INCLUDE_TESTS=OFF
          -DLLVM_OPTIMIZED_TABLEGEN=ON
        build_target: libclang
    - name: Run hdoc to generate documentation and push it to docs.hdoc.io
      uses: hdoc/hdoc-github-action@v2
      with:
        compile-commands-path: build/compile_commands.json
        hdoc-api-key: ${{ secrets.HDOC_PROJECT_API_KEY }}